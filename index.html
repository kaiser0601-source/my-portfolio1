<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾è‚¡è³‡ç”¢è‡ªå‹•è¿½è¹¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen flex items-center justify-center font-sans text-slate-900">

    <div id="login-section" class="bg-white p-10 rounded-2xl shadow-2xl w-full max-w-md border border-slate-200">
        <div class="text-center mb-8">
            <h2 class="text-3xl font-extrabold text-slate-800">è³‡ç”¢ä¿éšªç®±</h2>
            <p class="text-slate-500 mt-2">è«‹è¼¸å…¥å­˜å–å¯†ç¢¼</p>
        </div>
        <input type="password" id="password-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full p-3 border-2 border-slate-100 rounded-xl mb-4 focus:border-blue-500 focus:outline-none transition-all text-center text-lg">
        <button onclick="checkPassword()" class="w-full bg-slate-800 text-white py-3 rounded-xl font-bold hover:bg-slate-700 transition-all shadow-lg">è§£é–é€²å…¥</button>
        <p id="login-error" class="text-red-500 text-sm mt-4 text-center hidden">âŒ å¯†ç¢¼éŒ¯èª¤ï¼Œæ‹’çµ•å­˜å–ã€‚</p>
    </div>

    <div id="main-content" class="hidden w-full max-w-5xl p-6">
        <div class="bg-white p-8 rounded-2xl shadow-xl border border-slate-200">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                <div>
                    <h1 class="text-3xl font-black text-slate-800 tracking-tight">Portfolio Tracker</h1>
                    <p class="text-slate-400 text-sm">è‡ªå‹•é€£å‹• Finnhub å³æ™‚ç¾è‚¡è¡Œæƒ…</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="fetchAllPrices()" class="bg-blue-50 text-blue-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-100">ğŸ”„ åˆ·æ–°è¡Œæƒ…</button>
                    <button onclick="logout()" class="bg-slate-100 text-slate-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-slate-200">ç™»å‡º</button>
                </div>
            </div>

            <div class="mb-8 p-4 bg-amber-50 rounded-xl border border-amber-100">
                <label class="block text-xs font-bold text-amber-700 uppercase mb-1">Finnhub API Key</label>
                <div class="flex gap-2">
                    <input type="text" id="api-key-input" placeholder="d5ut0d1r01qr4f8acirgd5ut0d1r01qr4f8acis0" class="flex-1 p-2 border rounded-lg text-sm">
                    <button onclick="saveApiKey()" class="bg-amber-600 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-md">å„²å­˜</button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">ç¾è‚¡ä»£è™Ÿ (Symbol)</label>
                    <input type="text" id="asset-name" placeholder="ä¾‹å¦‚: NVDA" class="w-full p-3 border rounded-xl uppercase">
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1">æŒæœ‰è‚¡æ•¸ (Shares)</label>
                    <input type="number" id="asset-amount" placeholder="0.00" class="w-full p-3 border rounded-xl">
                </div>
                <div class="flex items-end">
                    <button onclick="addAsset()" class="w-full bg-blue-600 text-white p-3 rounded-xl font-bold hover:bg-blue-700 shadow-md">+ æ–°å¢è‡³çµ„åˆ</button>
                </div>
            </div>

            <div class="overflow-hidden rounded-xl border border-slate-100 mb-6">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 border-b border-slate-100">
                        <tr>
                            <th class="p-4 text-sm font-bold text-slate-500">ä»£è™Ÿ</th>
                            <th class="p-4 text-sm font-bold text-slate-500 text-right">æŒæœ‰è‚¡æ•¸</th>
                            <th class="p-4 text-sm font-bold text-slate-500 text-right">æœ€æ–°è‚¡åƒ¹ (USD)</th>
                            <th class="p-4 text-sm font-bold text-slate-500 text-right">ç›®å‰åƒ¹å€¼</th>
                            <th class="p-4 text-sm font-bold text-slate-500 text-center">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="asset-list" class="divide-y divide-slate-100">
                        </tbody>
                </table>
            </div>

            <div class="flex justify-end items-center p-6 bg-slate-900 rounded-2xl text-white">
                <span class="mr-4 text-slate-400">é ä¼°ç¸½è³‡ç”¢ï¼š</span>
                <span class="text-3xl font-black" id="total-value">$0.00</span>
            </div>
        </div>
    </div>

    <script>
        const PAGE_PASSWORD = "9003042449"; // é€™è£¡æ”¹ç¶²é å¯†ç¢¼
        let assets = JSON.parse(localStorage.getItem('us_assets')) || [];
        let finnhubKey = localStorage.getItem('finnhub_key') || "";

        // 1. ç™»å…¥é‚è¼¯
        function checkPassword() {
            if (document.getElementById('password-input').value === PAGE_PASSWORD) {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                init();
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        }

        function logout() { location.reload(); }

        // 2. åˆå§‹åŒ–
        function init() {
            document.getElementById('api-key-input').value = finnhubKey;
            renderAssets();
            if (finnhubKey) fetchAllPrices();
        }

        function saveApiKey() {
            finnhubKey = document.getElementById('api-key-input').value.trim();
            localStorage.setItem('finnhub_key', finnhubKey);
            alert('API Key å·²å„²å­˜ï¼');
            fetchAllPrices();
        }

        // 3. ç²å–è‚¡åƒ¹ (é—œéµ API å‘¼å«)
        async function fetchPrice(symbol) {
            if (!finnhubKey) return 0;
            try {
                const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol.toUpperCase()}&token=${finnhubKey}`);
                const data = await response.json();
                return data.c || 0; // 'c' ä»£è¡¨ Current Price
            } catch (e) {
                return 0;
            }
        }

        async function fetchAllPrices() {
            if (!finnhubKey) return alert("è«‹å…ˆè¼¸å…¥ API Key");
            for (let asset of assets) {
                asset.price = await fetchPrice(asset.name);
            }
            saveAndRender();
        }

        // 4. è³‡ç”¢æ“ä½œ
        async function addAsset() {
            const name = document.getElementById('asset-name').value.toUpperCase().trim();
            const amount = parseFloat(document.getElementById('asset-amount').value);
            if (!name || !amount) return;

            const price = await fetchPrice(name);
            assets.push({ name, amount, price });
            saveAndRender();
            document.getElementById('asset-name').value = "";
            document.getElementById('asset-amount').value = "";
        }

        function deleteAsset(index) {
            assets.splice(index, 1);
            saveAndRender();
        }

        function saveAndRender() {
            localStorage.setItem('us_assets', JSON.stringify(assets));
            renderAssets();
        }

        function renderAssets() {
            const list = document.getElementById('asset-list');
            list.innerHTML = '';
            let total = 0;

            assets.forEach((asset, index) => {
                const subtotal = asset.amount * (asset.price || 0);
                total += subtotal;
                list.innerHTML += `
                    <tr class="hover:bg-slate-50 transition-colors">
                        <td class="p-4 font-black text-slate-700">${asset.name}</td>
                        <td class="p-4 text-right font-mono">${asset.amount.toLocaleString()}</td>
                        <td class="p-4 text-right text-blue-600 font-mono font-bold">$${(asset.price || 0).toFixed(2)}</td>
                        <td class="p-4 text-right font-bold">$${subtotal.toLocaleString(undefined, {minimumFractionDigits: 2})}</td>
                        <td class="p-4 text-center">
                            <button onclick="deleteAsset(${index})" class="text-slate-300 hover:text-red-500 transition-colors">ç§»é™¤</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById('total-value').innerText = `$${total.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
        }
    </script>
</body>
</html>

